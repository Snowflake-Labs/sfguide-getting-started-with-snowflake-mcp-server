name: FINANCIAL_SERVICES_ANALYTICS
description: |
  Comprehensive semantic model for financial services analytics, providing 
  unified business definitions and relationships across customer data, 
  transactions, marketing campaigns, support interactions, and risk assessments. 
  Designed for natural language querying, executive dashboards, and 
  self-service business intelligence.
tables:
  - name: DIM_CAMPAIGNS
    description: This table stores information about marketing campaigns, including their objectives, target audience, budget, actual spend, performance metrics (impressions, clicks, conversions, revenue), and return on investment (ROI). It serves as a central repository for campaign data, enabling analysis and reporting on campaign effectiveness and efficiency.
    base_table:
      database: DASH_MCP_DB
      schema: DATA
      table: DIM_CAMPAIGNS
    dimensions:
      - name: CAMPAIGN_ID
        synonyms:
          - campaign_code
          - campaign_key
          - marketing_campaign_id
          - promotion_id
        description: Unique identifier for marketing campaigns.
        expr: CAMPAIGN_ID
        data_type: VARCHAR(10)
        sample_values:
          - CAMP00059
          - CAMP00229
          - CAMP00128
      - name: CAMPAIGN_TYPE
        synonyms:
          - channel_type
          - marketing_type
          - media_type
          - promotion_type
        description: Type of marketing campaign or communication channel used.
        expr: CAMPAIGN_TYPE
        data_type: VARCHAR(20)
        sample_values:
          - SMS
          - Direct Mail
          - Social Media
      - name: OBJECTIVE
        synonyms:
          - campaign_goal
          - campaign_intent
          - marketing_objective
          - purpose
        description: Primary business objective of the marketing campaign.
        expr: OBJECTIVE
        data_type: VARCHAR(20)
        sample_values:
          - Acquisition
          - Cross-sell
          - Brand Awareness
      - name: STATUS
        synonyms:
          - campaign_state
          - campaign_status
          - execution_status
          - progress_status
        description: Current status of the marketing campaign (Planning, Active, Completed, Paused, Cancelled).
        expr: STATUS
        data_type: VARCHAR(20)
        sample_values:
          - Active
          - Completed
          - Planned
      - name: TARGET_AUDIENCE
        synonyms:
          - audience_segment
          - customer_target
          - target_group
          - target_segment
        description: Customer segment targeted by the marketing campaign.
        expr: TARGET_AUDIENCE
        data_type: VARCHAR(20)
        sample_values:
          - Basic
          - Premium
          - Standard
    time_dimensions:
      - name: END_DATE
        synonyms:
          - campaign_end_date
          - completion_date
          - finish_date
          - termination_date
        description: Date when the marketing campaign ended or was completed.
        expr: END_DATE
        data_type: DATE
        sample_values:
          - '2024-10-08'
          - '2025-04-21'
          - '2024-08-26'
      - name: START_DATE
        synonyms:
          - begin_date
          - campaign_start_date
          - commencement_date
          - launch_date
        description: Date when the marketing campaign started or was launched.
        expr: START_DATE
        data_type: DATE
        sample_values:
          - '2023-12-20'
          - '2023-02-19'
          - '2023-07-14'
    facts:
      - name: ACTUAL_SPEND
        synonyms:
          - actual_cost
          - campaign_cost
          - spend
          - total_spend
        description: Actual amount spent on the marketing campaign.
        expr: ACTUAL_SPEND
        data_type: NUMBER(12,2)
        access_modifier: public_access
        sample_values:
          - '35966.12'
          - '63949.06'
          - '246160.78'
      - name: BUDGET
        synonyms:
          - allocated_budget
          - campaign_budget
          - investment
          - marketing_spend
        description: Total budget allocated for the marketing campaign.
        expr: BUDGET
        data_type: NUMBER(12,2)
        access_modifier: public_access
        sample_values:
          - '138959.19'
          - '201433.47'
          - '146981.51'
      - name: CONVERSIONS
        synonyms:
          - campaign_conversions
          - conversion_count
          - leads_converted
          - successful_conversions
        description: Total number of customers who converted as a result of the campaign.
        expr: CONVERSIONS
        data_type: NUMBER(8,0)
        access_modifier: public_access
        sample_values:
          - '4923'
          - '6268'
          - '2513'
      - name: ROI
        synonyms:
          - campaign_roi
          - marketing_roi
          - return_on_investment
          - roi_percentage
        description: Return on investment for the marketing campaign as a percentage.
        expr: ROI
        data_type: NUMBER(8,2)
        access_modifier: public_access
        sample_values:
          - '301.56'
          - '168.07'
          - '82.82'
    primary_key:
      columns:
        - CAMPAIGN_ID
  - name: DIM_CUSTOMERS
    description: This table stores information about customers, including their personal details, contact information, demographic data, financial information, and customer behavior metrics. It serves as a single source of truth for customer data, enabling analysis and reporting on customer segments, acquisition channels, and lifetime value.
    base_table:
      database: DASH_MCP_DB
      schema: DATA
      table: DIM_CUSTOMERS
    dimensions:
      - name: ACQUISITION_CHANNEL
        synonyms:
          - acquisition_source
          - lead_source
          - marketing_channel
          - origination_channel
          - source_channel
        description: Channel through which the customer was acquired by the institution.
        expr: ACQUISITION_CHANNEL
        data_type: VARCHAR(30)
        sample_values:
          - Branch
          - Online
          - Social Media
      - name: CUSTOMER_ID
        synonyms:
          - account_holder_id
          - client_id
          - client_key
          - customer_key
          - customer_number
        description: Unique identifier for each customer in the financial institution.
        expr: CUSTOMER_ID
        data_type: VARCHAR(10)
        sample_values:
          - CUST000234
          - CUST000169
          - CUST000015
      - name: CUSTOMER_SEGMENT
        synonyms:
          - client_segment
          - customer_category
          - customer_class
          - customer_tier
          - segment
          - tier
        description: Customer segmentation based on value and relationship depth (Premium, Standard, Basic, VIP).
        expr: CUSTOMER_SEGMENT
        data_type: VARCHAR(20)
        sample_values:
          - Premium
          - Basic
          - Standard
      - name: REGION
        synonyms:
          - area
          - geographic_region
          - market_region
          - territory
          - zone
        description: Geographic region where the customer is located for market analysis.
        expr: REGION
        data_type: VARCHAR(20)
        sample_values:
          - North
          - East
          - South
      - name: RISK_PROFILE
        synonyms:
          - credit_risk
          - risk_assessment
          - risk_category
          - risk_level
          - risk_rating
        description: Customer risk classification based on credit and behavioral analysis.
        expr: RISK_PROFILE
        data_type: VARCHAR(10)
        sample_values:
          - High
          - Low
          - Medium
      - name: STATUS
        synonyms:
          - account_state
          - account_status
          - customer_state
          - customer_status
          - relationship_status
        description: Current status of the customer relationship (Active, Inactive, Suspended, Closed).
        expr: STATUS
        data_type: VARCHAR(20)
        sample_values:
          - Active
          - Inactive
          - Suspended
    time_dimensions:
      - name: JOIN_DATE
        synonyms:
          - account_open_date
          - enrollment_date
          - onboarding_date
          - relationship_start_date
        description: Date when the customer first established their relationship with the institution.
        expr: JOIN_DATE
        data_type: DATE
        sample_values:
          - '2023-11-01'
          - '2024-12-07'
          - '2020-11-06'
    facts:
      - name: ANNUAL_INCOME
        synonyms:
          - gross_income
          - income
          - salary
          - yearly_earnings
          - yearly_income
        description: Customer's reported annual income used for lending and product decisions.
        expr: ANNUAL_INCOME
        data_type: NUMBER(10,2)
        access_modifier: public_access
        sample_values:
          - '285064.00'
          - '418456.00'
          - '245732.00'
      - name: CREDIT_SCORE
        synonyms:
          - credit_grade
          - credit_rating
          - creditworthiness
          - fico_score
        description: Customer's credit score ranging from 300 to 850, indicating creditworthiness.
        expr: CREDIT_SCORE
        data_type: NUMBER(3,0)
        access_modifier: public_access
        sample_values:
          - '780'
          - '570'
          - '685'
      - name: LIFETIME_VALUE
        synonyms:
          - clv
          - customer_value
          - customer_worth
          - relationship_value
          - total_value
        description: Calculated customer lifetime value representing total expected revenue from the relationship.
        expr: LIFETIME_VALUE
        data_type: NUMBER(10,2)
        access_modifier: public_access
        sample_values:
          - '3037.86'
          - '80036.17'
          - '88821.56'
    primary_key:
      columns:
        - CUSTOMER_ID
  - name: FACT_MARKETING_RESPONSES
    description: This table stores information about customer responses to marketing campaigns, including the date of contact, type of response, conversion value, and engagement score, allowing for analysis of campaign effectiveness and customer behavior.
    base_table:
      database: DASH_MCP_DB
      schema: DATA
      table: FACT_MARKETING_RESPONSES
    dimensions:
      - name: CAMPAIGN_ID
        synonyms:
          - campaign_code
          - campaign_key
          - marketing_campaign_id
          - promotion_id
        description: Foreign key linking to the marketing campaign that generated this response.
        expr: CAMPAIGN_ID
        data_type: VARCHAR(10)
        sample_values:
          - CAMP00001
          - CAMP00003
          - CAMP00004
      - name: CHANNEL_USED
        synonyms:
          - campaign_channel
          - communication_medium
          - marketing_channel
          - outreach_channel
        description: Channel through which the customer was contacted for the campaign.
        expr: CHANNEL_USED
        data_type: VARCHAR(20)
        sample_values:
          - SMS
          - Phone Call
          - Social Media
      - name: CUSTOMER_ID
        synonyms:
          - account_holder_id
          - client_id
          - customer_key
          - customer_number
        description: Foreign key linking to the customer who responded to the marketing campaign.
        expr: CUSTOMER_ID
        data_type: VARCHAR(10)
        sample_values:
          - CUST001653
          - CUST004248
          - CUST003490
      - name: RESPONSE_ID
        synonyms:
          - interaction_id
          - marketing_response_id
          - response_identifier
          - response_key
        description: Unique identifier for each marketing campaign response.
        expr: RESPONSE_ID
        data_type: VARCHAR(12)
        sample_values:
          - RESP00000069
          - RESP00000076
          - RESP00000097
      - name: RESPONSE_TYPE
        synonyms:
          - action_type
          - behavior_type
          - engagement_type
          - interaction_type
        description: Type of customer response to the marketing campaign.
        expr: RESPONSE_TYPE
        data_type: VARCHAR(20)
        sample_values:
          - Clicked
          - No Response
          - Opened
    time_dimensions:
      - name: CONTACTED_DATE
        synonyms:
          - campaign_date
          - communication_date
          - contact_date
          - outreach_date
        description: Date when the customer was contacted as part of the marketing campaign.
        expr: CONTACTED_DATE
        data_type: DATE
        sample_values:
          - '2024-11-16'
          - '2024-04-26'
          - '2024-12-22'
    facts:
      - name: CONVERSION_VALUE
        synonyms:
          - attributed_revenue
          - conversion_revenue
          - revenue_generated
          - sales_value
        description: Monetary value generated from customer conversions attributed to the campaign.
        expr: CONVERSION_VALUE
        data_type: NUMBER(10,2)
        access_modifier: public_access
        sample_values:
          - '0.00'
          - '2837.96'
          - '1469.91'
      - name: ENGAGEMENT_SCORE
        synonyms:
          - activity_score
          - interaction_score
          - involvement_score
          - participation_score
        description: Quantified engagement level of the customer with the marketing campaign (0-100).
        expr: ENGAGEMENT_SCORE
        data_type: NUMBER(3,0)
        access_modifier: public_access
        sample_values:
          - '33'
          - '25'
          - '32'
    primary_key:
      columns:
        - RESPONSE_ID
  - name: FACT_RISK_ASSESSMENTS
    description: This table stores historical risk assessment data for customers, capturing the assessment date, risk scores for credit, fraud, and anti-money laundering (AML), an overall risk rating, and relevant risk factors. It also tracks whether a review is required, the date of the last review, and the scheduled date for the next review.
    base_table:
      database: DASH_MCP_DB
      schema: DATA
      table: FACT_RISK_ASSESSMENTS
    dimensions:
      - name: ASSESSMENT_ID
        synonyms:
          - assessment_key
          - assessment_number
          - evaluation_id
          - risk_assessment_id
        description: Unique identifier for each risk assessment.
        expr: ASSESSMENT_ID
        data_type: VARCHAR(10)
        sample_values:
          - RISK000001
          - RISK000102
          - RISK000247
      - name: CUSTOMER_ID
        synonyms:
          - account_holder_id
          - client_id
          - customer_key
          - customer_number
        description: Foreign key linking to the customer being assessed for risk.
        expr: CUSTOMER_ID
        data_type: VARCHAR(10)
        sample_values:
          - CUST002057
          - CUST001517
          - CUST002624
      - name: OVERALL_RISK_RATING
        synonyms:
          - composite_risk
          - risk_category
          - risk_grade
          - risk_level
        description: Overall risk classification based on comprehensive risk analysis.
        expr: OVERALL_RISK_RATING
        data_type: VARCHAR(15)
        sample_values:
          - High
          - Low
          - Medium
    time_dimensions:
      - name: ASSESSMENT_DATE
        synonyms:
          - analysis_date
          - evaluation_date
          - review_date
          - risk_assessment_date
        description: Date when the risk assessment was conducted.
        expr: ASSESSMENT_DATE
        data_type: DATE
        sample_values:
          - '2024-04-28'
          - '2024-08-29'
          - '2025-07-30'
    facts:
      - name: AML_RISK_SCORE
        synonyms:
          - aml_score
          - anti_money_laundering_score
          - compliance_risk_score
          - regulatory_risk_score
        description: Anti-money laundering risk score for regulatory compliance (0-100).
        expr: AML_RISK_SCORE
        data_type: NUMBER(5,2)
        access_modifier: public_access
        sample_values:
          - '12.63'
          - '24.73'
          - '1.80'
      - name: CREDIT_RISK_SCORE
        synonyms:
          - credit_score
          - creditworthiness_score
          - default_risk_score
          - lending_risk_score
        description: Quantified credit risk score indicating likelihood of default (0-100).
        expr: CREDIT_RISK_SCORE
        data_type: NUMBER(5,2)
        access_modifier: public_access
        sample_values:
          - '23.24'
          - '20.48'
          - '33.10'
      - name: FRAUD_RISK_SCORE
        synonyms:
          - anomaly_risk_score
          - fraud_probability
          - fraud_score
          - suspicious_activity_score
        description: Fraud risk assessment score indicating likelihood of fraudulent activity (0-100).
        expr: FRAUD_RISK_SCORE
        data_type: NUMBER(5,2)
        access_modifier: public_access
        sample_values:
          - '25.32'
          - '10.00'
          - '44.65'
    primary_key:
      columns:
        - ASSESSMENT_ID
  - name: FACT_SUPPORT_TICKETS
    description: This table stores information about customer support tickets, including ticket details, customer and account information, ticket status, resolution details, and customer satisfaction scores, providing a comprehensive view of the support process and customer experience.
    base_table:
      database: DASH_MCP_DB
      schema: DATA
      table: FACT_SUPPORT_TICKETS
    dimensions:
      - name: ACCOUNT_ID
        synonyms:
          - account_identifier
          - account_key
          - account_number
          - related_account_id
        description: Foreign key linking to the account related to the support ticket (optional).
        expr: ACCOUNT_ID
        data_type: VARCHAR(10)
        sample_values:
          - ACC0007417
          - ACC0000794
          - ACC0002675
      - name: CATEGORY
        synonyms:
          - issue_type
          - problem_category
          - request_type
          - ticket_category
        description: Primary category of the customer support request or issue.
        expr: CATEGORY
        data_type: VARCHAR(30)
        sample_values:
          - Technical Problem
          - Complaint
          - Account Issue
      - name: CHANNEL
        synonyms:
          - communication_channel
          - contact_channel
          - service_channel
          - support_channel
        description: Channel through which the customer contacted support.
        expr: CHANNEL
        data_type: VARCHAR(20)
        sample_values:
          - Phone
          - Branch
          - Email
      - name: CUSTOMER_ID
        synonyms:
          - account_holder_id
          - client_id
          - customer_key
          - customer_number
        description: Foreign key linking to the customer who created the support ticket.
        expr: CUSTOMER_ID
        data_type: VARCHAR(10)
        sample_values:
          - CUST004043
          - CUST000761
          - CUST002928
      - name: PRIORITY
        synonyms:
          - escalation_level
          - importance_level
          - severity
          - urgency
        description: Priority level assigned to the support ticket (Low, Medium, High, Critical).
        expr: PRIORITY
        data_type: VARCHAR(10)
        sample_values:
          - High
          - Low
          - Medium
      - name: STATUS
        synonyms:
          - current_status
          - resolution_status
          - state
          - ticket_status
        description: Current status of the support ticket in the resolution workflow.
        expr: STATUS
        data_type: VARCHAR(20)
        sample_values:
          - Pending
          - Cancelled
          - Resolved
      - name: TICKET_ID
        synonyms:
          - case_id
          - support_ticket_id
          - ticket_key
          - ticket_number
        description: Unique identifier for each customer support ticket.
        expr: TICKET_ID
        data_type: VARCHAR(11)
        sample_values:
          - TKT00000174
          - TKT00000003
          - TKT00000078
    time_dimensions:
      - name: CREATED_DATE
        synonyms:
          - contact_date
          - request_date
          - submission_date
          - ticket_date
        description: Date when the support ticket was created or customer first contacted support.
        expr: CREATED_DATE
        data_type: DATE
        sample_values:
          - '2024-04-26'
          - '2025-07-18'
          - '2025-08-17'
    facts:
      - name: FIRST_RESPONSE_TIME_MINUTES
        synonyms:
          - first_contact_time
          - initial_response_time
          - response_time
          - time_to_first_response
        description: Time in minutes from ticket creation to first agent response.
        expr: FIRST_RESPONSE_TIME_MINUTES
        data_type: NUMBER(8,2)
        access_modifier: public_access
        sample_values:
          - '32.81'
          - '33.40'
          - '62.32'
      - name: RESOLUTION_TIME_HOURS
        synonyms:
          - completion_time
          - handling_time
          - resolution_time
          - time_to_resolve
        description: Total time in hours from ticket creation to resolution.
        expr: RESOLUTION_TIME_HOURS
        data_type: NUMBER(8,2)
        access_modifier: public_access
        sample_values:
          - '3.00'
          - '147.00'
          - '32.00'
      - name: SATISFACTION_SCORE
        synonyms:
          - csat
          - customer_satisfaction
          - satisfaction_rating
          - service_rating
        description: Customer satisfaction score on a 1-5 scale for the support interaction.
        expr: SATISFACTION_SCORE
        data_type: NUMBER(1,0)
        access_modifier: public_access
        sample_values:
          - '2'
          - '3'
    primary_key:
      columns:
        - TICKET_ID
  - name: FACT_TRANSACTIONS
    description: This table stores information about financial transactions, including the transaction ID, account and customer details, date, type, amount, and balance after the transaction. It also captures additional context such as the merchant name and category, transaction channel, location, and a description of the transaction. Furthermore, it includes flags for potentially suspicious transactions and a fraud score to indicate the likelihood of fraudulent activity.
    base_table:
      database: DASH_MCP_DB
      schema: DATA
      table: FACT_TRANSACTIONS
    dimensions:
      - name: ACCOUNT_ID
        synonyms:
          - account_identifier
          - account_key
          - account_number
          - bank_account_id
        description: Foreign key linking to the account involved in the transaction.
        expr: ACCOUNT_ID
        data_type: VARCHAR(16777216)
        sample_values:
          - ACC0003380
          - ACC0003960
          - ACC0007662
      - name: CHANNEL
        synonyms:
          - access_channel
          - delivery_channel
          - service_channel
          - transaction_channel
        description: Channel through which the transaction was initiated (ATM, Online, Mobile, Branch).
        expr: CHANNEL
        data_type: VARCHAR(16777216)
        sample_values:
          - ATM
          - ACH
          - Mobile
      - name: CUSTOMER_ID
        synonyms:
          - account_holder_id
          - client_id
          - customer_key
          - customer_number
        description: Foreign key linking to the customer who initiated the transaction.
        expr: CUSTOMER_ID
        data_type: VARCHAR(16777216)
        sample_values:
          - CUST002563
          - CUST004460
          - CUST001571
      - name: MERCHANT_CATEGORY
        synonyms:
          - business_category
          - mcc
          - merchant_type
          - vendor_category
        description: Category of merchant where the transaction occurred (for purchase transactions).
        expr: MERCHANT_CATEGORY
        data_type: VARCHAR(16777216)
        sample_values:
          - Entertainment
          - Restaurant
      - name: TRANSACTION_ID
        synonyms:
          - transaction_identifier
          - transaction_key
          - transaction_number
          - txn_id
        description: Unique identifier for each financial transaction.
        expr: TRANSACTION_ID
        data_type: VARCHAR(16777216)
        sample_values:
          - TXN00000001
          - TXN00000007
          - TXN00000150
      - name: TRANSACTION_TYPE
        synonyms:
          - activity_type
          - payment_type
          - transaction_category
          - txn_type
        description: Type of financial transaction (Deposit, Withdrawal, Transfer, Payment, etc.).
        expr: TRANSACTION_TYPE
        data_type: VARCHAR(16777216)
        sample_values:
          - Transfer
          - ATM
          - Withdrawal
    time_dimensions:
      - name: TRANSACTION_DATE
        synonyms:
          - activity_date
          - process_date
          - settlement_date
          - txn_date
        description: Date and time when the transaction occurred.
        expr: TRANSACTION_DATE
        data_type: TIMESTAMP_NTZ(9)
        sample_values:
          - 2024-11-25T00:00:00.000+0000
          - 2025-02-13T00:00:00.000+0000
          - 2025-01-16T00:00:00.000+0000
    facts:
      - name: AMOUNT
        synonyms:
          - dollar_amount
          - transaction_amount
          - transaction_value
          - txn_amount
          - value
        description: Monetary amount of the transaction (positive for credits, negative for debits).
        expr: AMOUNT
        data_type: NUMBER(38,2)
        access_modifier: public_access
        sample_values:
          - '-6952.60'
          - '-16.61'
          - '273.69'
      - name: BALANCE_AFTER
        synonyms:
          - account_balance
          - balance_post_transaction
          - ending_balance
          - remaining_balance
        description: Account balance immediately following the transaction.
        expr: BALANCE_AFTER
        data_type: NUMBER(38,2)
        access_modifier: public_access
        sample_values:
          - '-197639.98'
          - '646478.63'
          - '-156716.66'
      - name: FRAUD_SCORE
        synonyms:
          - anomaly_score
          - fraud_risk
          - risk_score
          - suspicious_score
        description: AI-generated fraud risk score from 0-100, with higher values indicating greater risk.
        expr: FRAUD_SCORE
        data_type: NUMBER(38,2)
        access_modifier: public_access
        sample_values:
          - '51.11'
          - '12.49'
          - '34.75'
    primary_key:
      columns:
        - TRANSACTION_ID
relationships:
  - name: MARKETING_TO_CAMPAIGNS
    left_table: FACT_MARKETING_RESPONSES
    right_table: DIM_CAMPAIGNS
    relationship_columns:
      - left_column: CAMPAIGN_ID
        right_column: CAMPAIGN_ID
    relationship_type: many_to_one
    join_type: inner
  - name: MARKETING_TO_CUSTOMERS
    left_table: FACT_MARKETING_RESPONSES
    right_table: DIM_CUSTOMERS
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: many_to_one
    join_type: inner
  - name: RISK_TO_CUSTOMERS
    left_table: FACT_RISK_ASSESSMENTS
    right_table: DIM_CUSTOMERS
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: many_to_one
    join_type: inner
  - name: SUPPORT_TO_CUSTOMERS
    left_table: FACT_SUPPORT_TICKETS
    right_table: DIM_CUSTOMERS
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: many_to_one
    join_type: inner
  - name: TRANSACTIONS_TO_CUSTOMERS
    left_table: FACT_TRANSACTIONS
    right_table: DIM_CUSTOMERS
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: many_to_one
    join_type: inner
verified_queries:
  - name: What is the average customer lifetime value by region for customers with Low risk profile?
    question: What is the average customer lifetime value by region for customers with Low risk profile?
    sql: |-
      SELECT
        c.region,
        MIN(c.join_date) AS start_date,
        MAX(c.join_date) AS end_date,
        AVG(c.lifetime_value) AS avg_lifetime_value
      FROM
        dim_customers AS c
      WHERE
        c.risk_profile = 'Low'
      GROUP BY
        c.region
      ORDER BY
        avg_lifetime_value DESC NULLS LAST
    use_as_onboarding_question: false
    verified_by: Dash Desai
    verified_at: 1758241734
  - name: What is the risk profile distribution across customer segments and their correlation with transaction volumes?
    question: What is the risk profile distribution across customer segments and their correlation with transaction volumes?
    sql: |-
      WITH customer_segments AS (
        SELECT
          c.customer_segment,
          c.risk_profile,
          COUNT(c.customer_id) AS customer_count
        FROM
          dim_customers AS c
        GROUP BY
          c.customer_segment,
          c.risk_profile
      ),
      transaction_volumes AS (
        SELECT
          c.customer_segment,
          c.risk_profile,
          COUNT(t.transaction_id) AS transaction_count,
          SUM(t.amount) AS total_transaction_amount
        FROM
          fact_transactions AS t
          INNER JOIN dim_customers AS c ON t.customer_id = c.customer_id
        GROUP BY
          c.customer_segment,
          c.risk_profile
      )
      SELECT
        cs.customer_segment,
        cs.risk_profile,
        cs.customer_count,
        COALESCE(tv.transaction_count, 0) AS transaction_count,
        COALESCE(tv.total_transaction_amount, 0) AS total_transaction_amount,
        CASE
          WHEN cs.customer_count > 0 THEN COALESCE(tv.transaction_count, 0) / NULLIF(cs.customer_count, 0)
          ELSE 0
        END AS avg_transactions_per_customer
      FROM
        customer_segments AS cs
        LEFT JOIN transaction_volumes AS tv ON cs.customer_segment = tv.customer_segment
        AND cs.risk_profile = tv.risk_profile
      ORDER BY
        cs.customer_segment,
        cs.risk_profile
    use_as_onboarding_question: false
    verified_by: Dash Desai
    verified_at: 1758241797